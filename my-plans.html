<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="myPlans.pageTitle">ÿÆÿ∑ÿ∑Ÿä ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ© - ÿßŸÉÿ™ÿ¥ŸÅ ŸÖÿµÿ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="plans/plans.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            margin-bottom: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .header .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-text h1 {
            font-size: 24px;
            color: #1a1a2e;
            margin: 0;
        }

        .logo-text span {
            font-size: 12px;
            color: #666;
        }

        .nav {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .lang-switch {
            display: flex;
            gap: 8px;
            background: #f5f5f5;
            padding: 5px;
            border-radius: 10px;
        }

        .lang-btn {
            padding: 8px 15px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }

        .lang-btn.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .user-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .user-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .page-header h1 {
            font-size: 42px;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .page-header p {
            font-size: 18px;
            opacity: 0.95;
        }

        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .plan-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .plan-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #D4AF37, #FFD700);
        }

        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .plan-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
        }

        .plan-title {
            font-size: 24px;
            color: #1a1a2e;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .plan-date {
            font-size: 14px;
            color: #888;
        }

        .plan-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-economic {
            background: #e3f2fd;
            color: #1976d2;
        }

        .badge-moderate {
            background: #fff3e0;
            color: #f57c00;
        }

        .badge-luxury {
            background: #fce4ec;
            color: #c2185b;
        }

        .plan-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .plan-detail {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .plan-detail-icon {
            font-size: 24px;
        }

        .plan-detail-text {
            flex: 1;
        }

        .plan-detail-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 3px;
        }

        .plan-detail-value {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a2e;
        }

        .plan-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .btn-danger {
            background: #ff4757;
            color: white;
        }

        .btn-danger:hover {
            background: #ff3838;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .empty-state h2 {
            font-size: 28px;
            color: #1a1a2e;
            margin-bottom: 15px;
        }

        .empty-state p {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
        }

        .btn-create {
            display: inline-block;
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-create:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .loading {
            text-align: center;
            padding: 80px 20px;
            color: white;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading h2 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        /* RTL Support */
        [dir="rtl"] .plan-card::before {
            right: 0;
            left: auto;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .plans-grid {
                grid-template-columns: 1fr;
            }

            .page-header h1 {
                font-size: 32px;
            }

            .plan-details {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 50 50">
                    <path d="M25 8L10 16L25 24L40 16L25 8Z" fill="#D4AF37" stroke="#FFD700" stroke-width="2"/>
                    <path d="M10 32L25 40L40 32M10 24L25 32L40 24" stroke="#D4AF37" fill="none" stroke-width="2.5"/>
                    <circle cx="25" cy="18" r="2.5" fill="#FFD700"/>
                </svg>
                <div class="logo-text">
                    <h1 data-i18n="siteName">ÿßŸÉÿ™ÿ¥ŸÅ ŸÖÿµÿ±</h1>
                    <span data-i18n="siteSubtitle">27 ŸÖÿ≠ÿßŸÅÿ∏ÿ© ŸÖÿµÿ±Ÿäÿ©</span>
                </div>
            </div>
            <nav class="nav">
                <div class="lang-switch">
                    <button class="lang-btn active" data-lang="ar">üá™üá¨ ÿπ</button>
                    <button class="lang-btn" data-lang="en">üá¨üáß EN</button>
                    <button class="lang-btn" data-lang="fr">üá´üá∑ FR</button>
                </div>
                <button class="user-btn" id="userBtn">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    <span id="userName" data-i18n="myAccount">ÿ≠ÿ≥ÿßÿ®Ÿä</span>
                </button>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="page-header">
            <h1 data-i18n="myPlans.title">ÿÆÿ∑ÿ∑Ÿä ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©</h1>
            <p data-i18n="myPlans.subtitle">ÿ¨ŸÖŸäÿπ ÿÆÿ∑ÿ∑ ÿ±ÿ≠ŸÑÿßÿ™ŸÉ ŸÅŸä ŸÖŸÉÿßŸÜ Ÿàÿßÿ≠ÿØ</p>
        </div>

        <div id="plansContainer">
            <div class="loading">
                <div class="loading-spinner"></div>
                <h2 data-i18n="common.loading">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</h2>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const CONFIG = {
            apiKey: "AIzaSyDdJHBy-Ai8MBQQgFJCsolOE1VvCPwWOCQ",
            authDomain: "discover-egypt-13ef7.firebaseapp.com",
            projectId: "discover-egypt-13ef7",
            storageBucket: "discover-egypt-13ef7.firebasestorage.app",
            messagingSenderId: "346176085799",
            appId: "1:346176085799:web:b1bb866154ea56ef6db8e3"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(CONFIG);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        // Translations
        const TRANSLATIONS = {
            ar: {
                siteName: 'ÿßŸÉÿ™ÿ¥ŸÅ ŸÖÿµÿ±',
                siteSubtitle: '27 ŸÖÿ≠ÿßŸÅÿ∏ÿ© ŸÖÿµÿ±Ÿäÿ©',
                myAccount: 'ÿ≠ÿ≥ÿßÿ®Ÿä',
                myPlans: {
                    pageTitle: 'ÿÆÿ∑ÿ∑Ÿä ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ© - ÿßŸÉÿ™ÿ¥ŸÅ ŸÖÿµÿ±',
                    title: 'ÿÆÿ∑ÿ∑Ÿä ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©',
                    subtitle: 'ÿ¨ŸÖŸäÿπ ÿÆÿ∑ÿ∑ ÿ±ÿ≠ŸÑÿßÿ™ŸÉ ŸÅŸä ŸÖŸÉÿßŸÜ Ÿàÿßÿ≠ÿØ',
                    emptyTitle: 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿÆÿ∑ÿ∑ ŸÖÿ≠ŸÅŸàÿ∏ÿ© ÿ®ÿπÿØ',
                    emptyMessage: 'ÿßÿ®ÿØÿ£ ÿ®ÿ•ŸÜÿ¥ÿßÿ° ÿÆÿ∑ÿ© ÿ±ÿ≠ŸÑÿ© ÿ¨ÿØŸäÿØÿ© ŸÑÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß',
                    createPlan: 'ÿ£ŸÜÿ¥ÿ¶ ÿÆÿ∑ÿ© ÿ¨ÿØŸäÿØÿ©',
                    loginRequired: 'Ÿäÿ¨ÿ® ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ£ŸàŸÑÿßŸã',
                    loginMessage: 'ÿ≥ÿ¨ŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ±ÿ§Ÿäÿ© ÿÆÿ∑ÿ∑ŸÉ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©'
                },
                tripTo: 'ÿ±ÿ≠ŸÑÿ© ÿ•ŸÑŸâ',
                duration: 'ÿßŸÑŸÖÿØÿ©',
                travelers: 'ÿßŸÑŸÖÿ≥ÿßŸÅÿ±ŸàŸÜ',
                budget: 'ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ©',
                day: 'ŸäŸàŸÖ',
                days: 'ÿ£ŸäÿßŸÖ',
                person: 'ÿ¥ÿÆÿµ',
                persons: 'ÿ£ÿ¥ÿÆÿßÿµ',
                economic: 'ÿßŸÇÿ™ÿµÿßÿØŸäÿ©',
                moderate: 'ŸÖÿ™Ÿàÿ≥ÿ∑ÿ©',
                luxury: 'ŸÅÿßÿÆÿ±ÿ©',
                viewPlan: 'ÿπÿ±ÿ∂ ÿßŸÑÿÆÿ∑ÿ©',
                downloadPDF: 'ÿ™ÿ≠ŸÖŸäŸÑ PDF',
                deletePlan: 'ÿ≠ÿ∞ŸÅ',
                confirmDelete: 'ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑÿÆÿ∑ÿ©ÿü',
                deleteSuccess: 'ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿÆÿ∑ÿ© ÿ®ŸÜÿ¨ÿßÿ≠',
                deleteError: 'ŸÅÿ¥ŸÑ ÿ≠ÿ∞ŸÅ ÿßŸÑÿÆÿ∑ÿ©',
                common: {
                    loading: 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...'
                }
            },
            en: {
                siteName: 'Discover Egypt',
                siteSubtitle: '27 Egyptian Governorates',
                myAccount: 'My Account',
                myPlans: {
                    pageTitle: 'My Saved Plans - Discover Egypt',
                    title: 'My Saved Plans',
                    subtitle: 'All your trip plans in one place',
                    emptyTitle: 'No saved plans yet',
                    emptyMessage: 'Start creating a new trip plan to see it here',
                    createPlan: 'Create New Plan',
                    loginRequired: 'Please login first',
                    loginMessage: 'Login to view your saved plans'
                },
                tripTo: 'Trip to',
                duration: 'Duration',
                travelers: 'Travelers',
                budget: 'Budget',
                day: 'day',
                days: 'days',
                person: 'person',
                persons: 'persons',
                economic: 'Economic',
                moderate: 'Moderate',
                luxury: 'Luxury',
                viewPlan: 'View Plan',
                downloadPDF: 'Download PDF',
                deletePlan: 'Delete',
                confirmDelete: 'Are you sure you want to delete this plan?',
                deleteSuccess: 'Plan deleted successfully',
                deleteError: 'Failed to delete plan',
                common: {
                    loading: 'Loading...'
                }
            },
            fr: {
                siteName: 'D√©couvrir l\'√âgypte',
                siteSubtitle: '27 Gouvernorats √âgyptiens',
                myAccount: 'Mon Compte',
                myPlans: {
                    pageTitle: 'Mes Plans Enregistr√©s - D√©couvrir l\'√âgypte',
                    title: 'Mes Plans Enregistr√©s',
                    subtitle: 'Tous vos plans de voyage en un seul endroit',
                    emptyTitle: 'Aucun plan enregistr√©',
                    emptyMessage: 'Commencez √† cr√©er un nouveau plan de voyage pour le voir ici',
                    createPlan: 'Cr√©er un Nouveau Plan',
                    loginRequired: 'Veuillez d\'abord vous connecter',
                    loginMessage: 'Connectez-vous pour voir vos plans enregistr√©s'
                },
                tripTo: 'Voyage √†',
                duration: 'Dur√©e',
                travelers: 'Voyageurs',
                budget: 'Budget',
                day: 'jour',
                days: 'jours',
                person: 'personne',
                persons: 'personnes',
                economic: '√âconomique',
                moderate: 'Moyen',
                luxury: 'Luxe',
                viewPlan: 'Voir le Plan',
                downloadPDF: 'T√©l√©charger PDF',
                deletePlan: 'Supprimer',
                confirmDelete: '√ätes-vous s√ªr de vouloir supprimer ce plan?',
                deleteSuccess: 'Plan supprim√© avec succ√®s',
                deleteError: '√âchec de la suppression du plan',
                common: {
                    loading: 'Chargement...'
                }
            }
        };

        // Language Management
        let currentLang = localStorage.getItem('language') || 'ar';

        function t(key) {
            const keys = key.split('.');
            let value = TRANSLATIONS[currentLang];
            for (const k of keys) {
                value = value?.[k];
            }
            return value || key;
        }

        function updatePageLanguage() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.textContent = t(key);
            });

            document.documentElement.lang = currentLang;
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.title = t('myPlans.pageTitle');
        }

        // Language Switcher
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                currentLang = btn.dataset.lang;
                localStorage.setItem('language', currentLang);
                
                document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                updatePageLanguage();
                loadPlans(); // Reload plans with new language
            });
        });

        // Initialize language
        updatePageLanguage();
        document.querySelector(`[data-lang="${currentLang}"]`)?.classList.add('active');

        // User Account
        let currentUser = null;

        auth.onAuthStateChanged(user => {
            currentUser = user;
            if (user) {
                document.getElementById('userName').textContent = user.displayName || user.email;
                loadPlans();
            } else {
                showLoginRequired();
            }
        });

        document.getElementById('userBtn').addEventListener('click', () => {
            if (currentUser) {
                if (confirm(currentLang === 'ar' ? 'ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ÿü' : currentLang === 'en' ? 'Do you want to logout?' : 'Voulez-vous vous d√©connecter?')) {
                    auth.signOut();
                    window.location.href = 'login.html';
                }
            } else {
                window.location.href = 'login.html';
            }
        });

        // Load Plans
        async function loadPlans() {
            const container = document.getElementById('plansContainer');
            
            if (!currentUser) {
                showLoginRequired();
                return;
            }

            try {
                const snapshot = await db.collection('plans')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('timestamp', 'desc')
                    .get();

                if (snapshot.empty) {
                    showEmptyState();
                } else {
                    const plans = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    renderPlans(plans);
                }
            } catch (error) {
                console.error('Error loading plans:', error);
                container.innerHTML = `<div class="empty-state">
                    <div class="empty-state-icon">‚ö†Ô∏è</div>
                    <h2>${currentLang === 'ar' ? 'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£' : currentLang === 'en' ? 'An error occurred' : 'Une erreur s\'est produite'}</h2>
                    <p>${error.message}</p>
                </div>`;
            }
        }

        function showLoginRequired() {
            const container = document.getElementById('plansContainer');
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üîí</div>
                    <h2>${t('myPlans.loginRequired')}</h2>
                    <p>${t('myPlans.loginMessage')}</p>
                    <a href="login.html" class="btn-create">${t('myAccount')}</a>
                </div>
            `;
        }

        function showEmptyState() {
            const container = document.getElementById('plansContainer');
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <h2>${t('myPlans.emptyTitle')}</h2>
                    <p>${t('myPlans.emptyMessage')}</p>
                    <a href="plans/index.html" class="btn-create">${t('myPlans.createPlan')}</a>
                </div>
            `;
        }

        function renderPlans(plans) {
            const container = document.getElementById('plansContainer');
            const html = `
                <div class="plans-grid">
                    ${plans.map(plan => createPlanCard(plan)).join('')}
                </div>
            `;
            container.innerHTML = html;
        }

        function createPlanCard(plan) {
            const date = new Date(plan.timestamp);
            const dateStr = date.toLocaleDateString(currentLang === 'ar' ? 'ar-EG' : currentLang === 'fr' ? 'fr-FR' : 'en-US');
            
            const budgetClass = plan.budget === 'economic' ? 'badge-economic' : 
                               plan.budget === 'moderate' ? 'badge-moderate' : 'badge-luxury';
            
            const durationText = plan.duration === 1 ? t('day') : t('days');
            const travelersText = plan.travelers === 1 ? t('person') : t('persons');

            return `
                <div class="plan-card">
                    <div class="plan-card-header">
                        <div>
                            <div class="plan-title">${t('tripTo')} ${getGovernorateNameInCurrentLang(plan.governorate)}</div>
                            <div class="plan-date">${dateStr}</div>
                        </div>
                        <span class="plan-badge ${budgetClass}">${t(plan.budget)}</span>
                    </div>
                    
                    <div class="plan-details">
                        <div class="plan-detail">
                            <div class="plan-detail-icon">üìÖ</div>
                            <div class="plan-detail-text">
                                <div class="plan-detail-label">${t('duration')}</div>
                                <div class="plan-detail-value">${plan.duration} ${durationText}</div>
                            </div>
                        </div>
                        
                        <div class="plan-detail">
                            <div class="plan-detail-icon">üë•</div>
                            <div class="plan-detail-text">
                                <div class="plan-detail-label">${t('travelers')}</div>
                                <div class="plan-detail-value">${plan.travelers} ${travelersText}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="plan-actions">
                        <button class="action-btn btn-primary" onclick="viewPlan('${plan.id}')">
                            üëÅÔ∏è ${t('viewPlan')}
                        </button>
                        <button class="action-btn btn-secondary" onclick="downloadPlanPDF('${plan.id}')">
                            üìÑ ${t('downloadPDF')}
                        </button>
                        <button class="action-btn btn-danger" onclick="deletePlan('${plan.id}')">
                            üóëÔ∏è ${t('deletePlan')}
                        </button>
                    </div>
                </div>
            `;
        }

        function getGovernorateNameInCurrentLang(govCode) {
            const govNames = {
                ar: {
                    'cairo': 'ÿßŸÑŸÇÿßŸáÿ±ÿ©',
                    'giza': 'ÿßŸÑÿ¨Ÿäÿ≤ÿ©',
                    'alexandria': 'ÿßŸÑÿ•ÿ≥ŸÉŸÜÿØÿ±Ÿäÿ©',
                    'luxor': 'ÿßŸÑÿ£ŸÇÿµÿ±',
                    'aswan': 'ÿ£ÿ≥ŸàÿßŸÜ',
                    'sharm': 'ÿ¥ÿ±ŸÖ ÿßŸÑÿ¥ŸäÿÆ',
                    'hurghada': 'ÿßŸÑÿ∫ÿ±ÿØŸÇÿ©',
                    'dahab': 'ÿØŸáÿ®',
                    'marsa': 'ŸÖÿ±ÿ≥Ÿâ ÿπŸÑŸÖ'
                },
                en: {
                    'cairo': 'Cairo',
                    'giza': 'Giza',
                    'alexandria': 'Alexandria',
                    'luxor': 'Luxor',
                    'aswan': 'Aswan',
                    'sharm': 'Sharm El Sheikh',
                    'hurghada': 'Hurghada',
                    'dahab': 'Dahab',
                    'marsa': 'Marsa Alam'
                },
                fr: {
                    'cairo': 'Le Caire',
                    'giza': 'Gizeh',
                    'alexandria': 'Alexandrie',
                    'luxor': 'Louxor',
                    'aswan': 'Assouan',
                    'sharm': 'Charm el-Cheikh',
                    'hurghada': 'Hurghada',
                    'dahab': 'Dahab',
                    'marsa': 'Marsa Alam'
                }
            };

            return govNames[currentLang]?.[govCode] || govCode;
        }

        function viewPlan(planId) {
            window.location.href = `plans/index.html?viewPlan=${planId}`;
        }

        async function downloadPlanPDF(planId) {
            alert(currentLang === 'ar' ? 'ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ PDF...' : currentLang === 'en' ? 'Downloading PDF...' : 'T√©l√©chargement PDF...');
            // This would integrate with the PDF generation in plans.js
        }

        async function deletePlan(planId) {
            if (!confirm(t('confirmDelete'))) return;

            try {
                await db.collection('plans').doc(planId).delete();
                alert(t('deleteSuccess'));
                loadPlans();
            } catch (error) {
                console.error('Error deleting plan:', error);
                alert(t('deleteError'));
            }
        }
    </script>
</body>
</html>
